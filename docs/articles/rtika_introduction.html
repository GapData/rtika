<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to rtika • rtika</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to rtika">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">rtika</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/rtika_introduction.html">Introduction to rtika</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="http://github.com/predict-r/rtika">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Introduction to rtika</h1>
                        <h4 class="author">Sasha Goodman</h4>
            
            <h4 class="date">2018-03-01</h4>
          </div>

    
    
<div class="contents">
<div id="a-digital-babel-fish" class="section level1">
<h1 class="hasAnchor">
<a href="#a-digital-babel-fish" class="anchor"></a>A Digital Babel Fish</h1>
<p>Apache Tika is similar to the Babel fish in Douglas Adam’s book, “The Hitchhikers’ Guide to the Galaxy” <span class="citation">(C. Mattmann and Zitting 2011, 3)</span>. The Babel fish translates any natural language to any other. While Apache Tika does not yet translate natural languages (that is in the works with Apache Joshua), it is a technology that aims to tame the tower of babel of digital document formats. As the Babel fish allowed a person to understand Vogon poetry, Tika allows a computer to extract text and objects from Microsoft Word.</p>
<p>The world of digital documents and their file formats is like a place where every community has their own set of languages. Academic, business, government, and online communities use anywhere from a few file types to thousands. Unfortunately, attempts to unify groups around a single format are typically frustrated <span class="citation">(C. A. Mattmann 2013)</span>.</p>
<p>This plethora of file formats has become a common concern. Tika is a common library to address the issue. Starting in Apache Nutch in 2005, Tika became its own project in 2007 and then a component of other Apache projects including Nutch, Lucene, Jackrabbit, Mahout, and Solr <span class="citation">(C. Mattmann and Zitting 2011, 17)</span>.</p>
<p>With the increased volume of data to ingest found in digital archives, and terabyte sized data becoming common, Tika’s design goals include keeping the complexity at bay, memory consumption low, and processing speed fast <span class="citation">(C. Mattmann and Zitting 2011, 18)</span>.</p>
<p>The <code>rtika</code> package is an interface to Apache Tika that leverages Tika’s efficient batch processor to parse lists of documents fairly quickly. Therefore, I recommend using batches whenever possible. Currently, all the <code><a href="../reference/tika.html">tika()</a></code> functions take some time to spin up, and that will get annoying with hundreds of separate calls the functions.</p>
<p>The practice of piping batches of data into a function is not uncommon and is becoming a popular style with the <code>magrittr</code> R package. That style makes such pipelines easy to code, and they are almost self-documenting.</p>
</div>
<div id="use-tika_text-to-extract-plain-text" class="section level1">
<h1 class="hasAnchor">
<a href="#use-tika_text-to-extract-plain-text" class="anchor"></a>Use tika_text() to Extract Plain Text</h1>
<p>Video, sound and images are important file types, and yet much of the meaningful data in the world remains numeric or textual. Tika can parse many textual formats to extract alpha-numeric text, along with a few characters that control the arrangement of text like line breaks. For example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">require</span>(<span class="st">'rtika'</span>)
<span class="co">#&gt; Loading required package: rtika</span>
<span class="kw">require</span>(<span class="st">'magrittr'</span>)
<span class="co">#&gt; Loading required package: magrittr</span>

<span class="co"># The manuals directory</span>
<span class="co"># contains 37 PDF files manuals </span>
<span class="co"># of popular R packages.</span>
<span class="co"># It is about 7.7 MB in total.</span>
my_path &lt;-<span class="st"> "~/manuals"</span>

<span class="co"># Get all the files in that directory</span>
batch &lt;-<span class="st"> </span><span class="kw">file.path</span>(my_path,
                <span class="kw">list.files</span>(<span class="dt">path =</span> my_path,
                <span class="dt">recursive=</span><span class="ot">TRUE</span>))


<span class="co"># pipe the batch into tika_text() </span>
<span class="co"># get plain text</span>
<span class="kw">system.time</span>(
text &lt;-<span class="st">  </span>
<span class="st">    </span>batch <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw"><a href="../reference/tika_text.html">tika_text</a></span>() 
)
<span class="co">#&gt;    user  system elapsed </span>
<span class="co">#&gt;  13.100   1.070   9.583</span></code></pre></div>
<p>The output is a R character vector of the same length and order as the input files.</p>
<p>Occasionally, files are not parsable and the returned value for that file is <code>NA</code>. The reasons for unparsable files include corrupt files, disk input/output issues, empty files, password protection, a unhandled format, the document structure is broken, or the document has an unexpected variation.</p>
<p>These issues should be rare. Tika works very well on most documents. If an archive is very large there may be a small percentage of unparsable files, and you might want to handle them.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Find which files had an issue</span>
<span class="co"># Handle them if needed</span>
batch[<span class="kw">which</span>(<span class="kw">is.na</span>(text))]
<span class="co">#&gt; character(0)</span></code></pre></div>
<p>Plain text is reasonably easy to search through using <code><a href="http://www.rdocumentation.org/packages/base/topics/grep">base::grep()</a></code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
results &lt;-
<span class="st">    </span>text[ base<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/base/topics/grep">grep</a></span>(<span class="dt">pattern=</span><span class="st">'the'</span>,<span class="dt">x=</span>text) ]

<span class="kw">length</span>(results)
<span class="co">#&gt; [1] 37</span></code></pre></div>
<p>With plain text, a variety of interesting analyses are possible ranging from word counting to making matrices for deep learning predictions. Many of these common cases are handled easily with the very well documented <code>tidytext</code> package <span class="citation">(Silge and Robinson 2017)</span>. Among other things, it handles tokenization and creating term-document matrices.</p>
</div>
<div id="parameters-for-very-big-datasets" class="section level1">
<h1 class="hasAnchor">
<a href="#parameters-for-very-big-datasets" class="anchor"></a>Parameters for Very Big Datasets</h1>
<p>Very large processing jobs are possible with <code>rtika</code>, with a caveat. The R object returned by <code>tika</code> can become very large when there are hundreds of thousands of documents. In such a case, it’s best to use the computer’s disk to avoid running out of RAM. Most computers have much more disk space than RAM.</p>
<p>This can be done by setting two parameters in <code><a href="../reference/tika_text.html">tika_text()</a></code>, <code><a href="../reference/tika_xml.html">tika_xml()</a></code>, <code><a href="../reference/tika_html.html">tika_html()</a></code> or <code><a href="../reference/tika_json.html">tika_json()</a></code>. First, set <code>return=FALSE</code> to avoid returning the big R character vector in RAM. Second, specify an existing directory on the file system using <code>output_dir</code> to save the processed files in. The files can be more easily dealt with in smaller batches later on.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># create a directory not already in use.</span>
my_directory &lt;-
<span class="st">   </span><span class="kw">tempfile</span>(<span class="st">'rtika_output_dir'</span>,
                           <span class="dt">tmpdir=</span><span class="st">'~'</span>)
                  
<span class="kw">dir.create</span>(my_directory)

<span class="co"># normalizePath creates a canonical, user-understandable absolute path </span>
my_directory &lt;-<span class="st"> </span><span class="kw">normalizePath</span>(my_directory)

<span class="co"># pipe a batch tika_text()</span>
batch <span class="op">%&gt;%</span>
<span class="kw"><a href="../reference/tika_text.html">tika_text</a></span>(<span class="dt">threads=</span><span class="dv">4</span>,
          <span class="dt">return=</span><span class="ot">FALSE</span>,
          <span class="dt">output_dir =</span> my_directory) 

<span class="co"># list all the file locations </span>
saved_files &lt;-<span class="st"> </span><span class="kw">file.path</span>(my_directory,
                <span class="kw">list.files</span>(<span class="dt">path =</span> my_directory,
                <span class="dt">recursive=</span><span class="ot">TRUE</span>)
                )</code></pre></div>
<p>The location of each file in <code>output_dir</code> follows the convention from the Apache Tika batch processor: the full path to each file mirrors the original file’s path, only within the <code>output_dir</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">saved_files[<span class="dv">1</span><span class="op">:</span><span class="dv">7</span>]
<span class="co">#&gt; [1] "/home/project/rtika_output_dir52fd11421584/home/project/manuals/assertthat.pdf.txt"</span>
<span class="co">#&gt; [2] "/home/project/rtika_output_dir52fd11421584/home/project/manuals/BH.pdf.txt"        </span>
<span class="co">#&gt; [3] "/home/project/rtika_output_dir52fd11421584/home/project/manuals/colorspace.pdf.txt"</span>
<span class="co">#&gt; [4] "/home/project/rtika_output_dir52fd11421584/home/project/manuals/crayon.pdf.txt"    </span>
<span class="co">#&gt; [5] "/home/project/rtika_output_dir52fd11421584/home/project/manuals/curl.pdf.txt"      </span>
<span class="co">#&gt; [6] "/home/project/rtika_output_dir52fd11421584/home/project/manuals/dbplyr.pdf.txt"    </span>
<span class="co">#&gt; [7] "/home/project/rtika_output_dir52fd11421584/home/project/manuals/devtools.pdf.txt"</span></code></pre></div>
</div>
<div id="use-tika_fetch-to-preserve-content-type-when-downloading" class="section level1">
<h1 class="hasAnchor">
<a href="#use-tika_fetch-to-preserve-content-type-when-downloading" class="anchor"></a>Use tika_fetch() to Preserve Content-Type when Downloading</h1>
<p>A general suggestion is to use <code><a href="../reference/tika_fetch.html">tika_fetch()</a></code> to download files from the Internet, to preserve the Content-Type information in the file extension.</p>
<p>Tika’s Content-Type detection is improved with file extensions (Tika also relies on other features such as Magic bytes, which are unique control bytes in the file header). The file extensions should be used whenever possible. The <code><a href="../reference/tika_fetch.html">tika_fetch()</a></code> function tries to preserves Content-Type information from the download server.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">download_directory =<span class="st"> </span><span class="kw">tempfile</span>(<span class="st">'rtika_download_dir'</span>,
                           <span class="dt">tmpdir=</span><span class="st">'~'</span>)

<span class="kw">dir.create</span>(download_directory)

download_directory &lt;-<span class="st"> </span><span class="kw">normalizePath</span>(download_directory)

batch &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">'https://tika.apache.org/'</span>,
           <span class="st">'https://cran.r-project.org/doc/manuals/r-release/R-data.pdf'</span>,
           <span class="st">'https://cran.r-project.org/doc/manuals/r-release/R-lang.html'</span>)

downloads &lt;-<span class="st"> </span>
<span class="st">    </span>batch <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw"><a href="../reference/tika_fetch.html">tika_fetch</a></span>(download_directory)

<span class="co"># it will add the appropriate file extension to the downloads</span>
downloads
<span class="co">#&gt; [1] "/home/project/rtika_download_dir52fd73885c66/rtika_file52fd21c265d.html" </span>
<span class="co">#&gt; [2] "/home/project/rtika_download_dir52fd73885c66/rtika_file52fd51176881.pdf" </span>
<span class="co">#&gt; [3] "/home/project/rtika_download_dir52fd73885c66/rtika_file52fd5c8c8690.html"</span></code></pre></div>
<p>This <code><a href="../reference/tika_fetch.html">tika_fetch()</a></code> function is used internally by the other functions when processing URLs. However, then the downloaded files are left in a temporary directory and lost at the end of the R session. By using <code><a href="../reference/tika_fetch.html">tika_fetch()</a></code> with a directory of your choice, you can save the files and return to them later. <code><a href="../reference/tika_fetch.html">tika_fetch()</a></code> also has a <code>retries</code> parameter to help if an intermittent connection error stops a download.</p>
</div>
<div id="use-either-tika_html-or-tika_xml-to-get-structured-xhtml" class="section level1">
<h1 class="hasAnchor">
<a href="#use-either-tika_html-or-tika_xml-to-get-structured-xhtml" class="anchor"></a>Use Either tika_html() or tika_xml() to Get Structured XHTML</h1>
<p>Plain text falls short sometimes. For example, pagination might be important for selecting page ranges. The Tika authors chose HTML as a universal format because it offers semantic elements that are so common they are easy to learn or already feel familiar. For example, the hyperlink is represented in HTML as the anchor element <code>&lt;a&gt;</code> with the attribute <code>href</code>. The HTML in Tika preserves this metadata:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">'xml2'</span>)


<span class="co"># get XHTML text</span>
html &lt;-<span class="st"> </span>
<span class="st">    </span>downloads <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw"><a href="../reference/tika_html.html">tika_html</a></span>() <span class="op">%&gt;%</span>
<span class="st">     </span><span class="kw">lapply</span>(xml2<span class="op">::</span>read_html)

<span class="co"># parse links from documents</span>
links &lt;-
<span class="st">    </span>html <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">lapply</span>(xml2<span class="op">::</span>xml_find_all, <span class="st">'//a'</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">lapply</span>(xml2<span class="op">::</span>xml_attr, <span class="st">'href'</span>)

links[[<span class="dv">2</span>]][<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]
<span class="co">#&gt; [1] "https://CRAN.R-project.org/package=DBI"</span>
<span class="co">#&gt; [2] "https://CRAN.R-project.org/package=DBI"</span>
<span class="co">#&gt; [3] "https://CRAN.R-project.org/package=DBI"</span>
<span class="co">#&gt; [4] "https://CRAN.R-project.org/package=DBI"</span>
<span class="co">#&gt; [5] "https://CRAN.R-project.org/package=DBI"</span></code></pre></div>
<p>Each type of file has different information preserved by Tika’s internal parsers. The particular aspects vary. Some notes:</p>
<pre><code>* PDF files retain pagination, with each page starting with the XHTML element `&lt;div class="page"&gt;`. 
* PDFs retain hyperlinks in the anchor element `&lt;a&gt;` with the attribute `href`.
* Word and Excel documents retain tabular data as a `&lt;table&gt;` element. The `rvest` package has a function to get tables of data  with `rvest::html_table()`.
* Multiple Excel sheets are preserved as multiple XHTML tables. Ragged tables, where rows have differing numbers of cells, are not supported.</code></pre>
<p>Note that <code><a href="../reference/tika_html.html">tika_html()</a></code> and <code><a href="../reference/tika_xml.html">tika_xml()</a></code> both produce the same strict form of HTML called XHTML, and either works essentially the same for all the documents I’ve tried.</p>
</div>
<div id="a-bit-of-xhtml-metadata" class="section level1">
<h1 class="hasAnchor">
<a href="#a-bit-of-xhtml-metadata" class="anchor"></a>A Bit of XHTML Metadata</h1>
<p>The <code><a href="../reference/tika_html.html">tika_html()</a></code> and <code><a href="../reference/tika_xml.html">tika_xml()</a></code> functions are focused on extracting strict, structured HTML as XHTML. In addition, basic metadata can be accessed in the <code>meta</code> tags of the XHTML. The MIME type is sometimes recorded in the Dublin Core metadata <code>dc:format</code> (<a href="http://dublincore.org/" class="uri">http://dublincore.org/</a>):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">html <span class="op">%&gt;%</span>
<span class="kw">lapply</span>(xml2<span class="op">::</span>xml_find_first, <span class="st">'//meta[@name="dc:format"]'</span>) <span class="op">%&gt;%</span>
<span class="kw">lapply</span>(xml2<span class="op">::</span>xml_attr,<span class="st">'content'</span>) <span class="op">%&gt;%</span>
<span class="kw">unlist</span>()
<span class="co">#&gt; [1] NA                             "application/pdf; version=1.5"</span>
<span class="co">#&gt; [3] NA</span>

<span class="co"># show all available metadata</span>
html <span class="op">%&gt;%</span>
<span class="kw">lapply</span>(xml2<span class="op">::</span>xml_find_all,<span class="st">'//meta'</span>) 
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt; {xml_nodeset (11)}</span>
<span class="co">#&gt;  [1] &lt;meta name="X-Parsed-By" content="org.apache.tika.parser.DefaultPar ...</span>
<span class="co">#&gt;  [2] &lt;meta name="X-Parsed-By" content="org.apache.tika.parser.html.HtmlP ...</span>
<span class="co">#&gt;  [3] &lt;meta name="dc:title" content="Apache Tika – Apache Tika"&gt;\n</span>
<span class="co">#&gt;  [4] &lt;meta name="tika:file_ext" content="html"&gt;\n</span>
<span class="co">#&gt;  [5] &lt;meta name="Content-Encoding" content="UTF-8"&gt;\n</span>
<span class="co">#&gt;  [6] &lt;meta name="Content-Type-Hint" content="text/html; charset=UTF-8"&gt;\n</span>
<span class="co">#&gt;  [7] &lt;meta name="tika_batch_fs:relative_path" content="home/project/rtik ...</span>
<span class="co">#&gt;  [8] &lt;meta name="resourceName" content="rtika_file52fd21c265d.html"&gt;\n</span>
<span class="co">#&gt;  [9] &lt;meta name="Content-Length" content="34144"&gt;\n</span>
<span class="co">#&gt; [10] &lt;meta name="X-TIKA:digest:MD5" content="6c45bb17c53941b781930f9683b ...</span>
<span class="co">#&gt; [11] &lt;meta name="Content-Type" content="application/xhtml+xml; charset=U ...</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]</span>
<span class="co">#&gt; {xml_nodeset (40)}</span>
<span class="co">#&gt;  [1] &lt;meta name="date" content="2017-11-30T13:39:02Z"&gt;\n</span>
<span class="co">#&gt;  [2] &lt;meta name="pdf:PDFVersion" content="1.5"&gt;\n</span>
<span class="co">#&gt;  [3] &lt;meta name="xmp:CreatorTool" content="TeX"&gt;\n</span>
<span class="co">#&gt;  [4] &lt;meta name="access_permission:modify_annotations" content="true"&gt;\n</span>
<span class="co">#&gt;  [5] &lt;meta name="access_permission:can_print_degraded" content="true"&gt;\n</span>
<span class="co">#&gt;  [6] &lt;meta name="tika_batch_fs:relative_path" content="home/project/rtik ...</span>
<span class="co">#&gt;  [7] &lt;meta name="dcterms:created" content="2017-11-30T13:39:02Z"&gt;\n</span>
<span class="co">#&gt;  [8] &lt;meta name="Last-Modified" content="2017-11-30T13:39:02Z"&gt;\n</span>
<span class="co">#&gt;  [9] &lt;meta name="dcterms:modified" content="2017-11-30T13:39:02Z"&gt;\n</span>
<span class="co">#&gt; [10] &lt;meta name="dc:format" content="application/pdf; version=1.5"&gt;\n</span>
<span class="co">#&gt; [11] &lt;meta name="Last-Save-Date" content="2017-11-30T13:39:02Z"&gt;\n</span>
<span class="co">#&gt; [12] &lt;meta name="pdf:docinfo:creator_tool" content="TeX"&gt;\n</span>
<span class="co">#&gt; [13] &lt;meta name="access_permission:fill_in_form" content="true"&gt;\n</span>
<span class="co">#&gt; [14] &lt;meta name="pdf:docinfo:modified" content="2017-11-30T13:39:02Z"&gt;\n</span>
<span class="co">#&gt; [15] &lt;meta name="meta:save-date" content="2017-11-30T13:39:02Z"&gt;\n</span>
<span class="co">#&gt; [16] &lt;meta name="pdf:encrypted" content="false"&gt;\n</span>
<span class="co">#&gt; [17] &lt;meta name="pdf:docinfo:custom:PTEX.Fullbanner" content="This is pd ...</span>
<span class="co">#&gt; [18] &lt;meta name="modified" content="2017-11-30T13:39:02Z"&gt;\n</span>
<span class="co">#&gt; [19] &lt;meta name="Content-Length" content="309939"&gt;\n</span>
<span class="co">#&gt; [20] &lt;meta name="X-TIKA:digest:MD5" content="3f1b649a4ec70aaa4c2dad4eade ...</span>
<span class="co">#&gt; ...</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[3]]</span>
<span class="co">#&gt; {xml_nodeset (16)}</span>
<span class="co">#&gt;  [1] &lt;meta name="X-Parsed-By" content="org.apache.tika.parser.DefaultPar ...</span>
<span class="co">#&gt;  [2] &lt;meta name="X-Parsed-By" content="org.apache.tika.parser.html.HtmlP ...</span>
<span class="co">#&gt;  [3] &lt;meta name="keywords" content="R Language Definition"&gt;\n</span>
<span class="co">#&gt;  [4] &lt;meta name="tika_batch_fs:relative_path" content="home/project/rtik ...</span>
<span class="co">#&gt;  [5] &lt;meta name="description" content="R Language Definition"&gt;\n</span>
<span class="co">#&gt;  [6] &lt;meta name="resourceName" content="rtika_file52fd5c8c8690.html"&gt;\n</span>
<span class="co">#&gt;  [7] &lt;meta name="distribution" content="global"&gt;\n</span>
<span class="co">#&gt;  [8] &lt;meta name="dc:title" content="R Language Definition"&gt;\n</span>
<span class="co">#&gt;  [9] &lt;meta name="tika:file_ext" content="html"&gt;\n</span>
<span class="co">#&gt; [10] &lt;meta name="Content-Encoding" content="UTF-8"&gt;\n</span>
<span class="co">#&gt; [11] &lt;meta name="Content-Type-Hint" content="text/html; charset=UTF-8"&gt;\n</span>
<span class="co">#&gt; [12] &lt;meta name="resource-type" content="document"&gt;\n</span>
<span class="co">#&gt; [13] &lt;meta name="Content-Length" content="345101"&gt;\n</span>
<span class="co">#&gt; [14] &lt;meta name="X-TIKA:digest:MD5" content="a57953f9fceca3ec0fcb210e37d ...</span>
<span class="co">#&gt; [15] &lt;meta name="Content-Type" content="text/html; charset=UTF-8"&gt;\n</span>
<span class="co">#&gt; [16] &lt;meta name="Generator" content="texi2any"&gt;\n</span></code></pre></div>
<p>More metadata can be accessed with the <code><a href="../reference/tika_json.html">tika_json()</a></code></p>
</div>
<div id="use-tika_json-for-images" class="section level1">
<h1 class="hasAnchor">
<a href="#use-tika_json-for-images" class="anchor"></a>Use tika_json() for Images</h1>
<p>Consider all that can be found from a single image:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">'jsonlite'</span>)
batch =<span class="st"> </span><span class="kw">normalizePath</span>(<span class="st">'~/rtika/tests/testthat/calculator.jpg'</span>)

<span class="co"># a list of data.frames</span>
metadata &lt;-
<span class="st">    </span>batch <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw"><a href="../reference/tika_json.html">tika_json</a></span>() <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">lapply</span>(jsonlite<span class="op">::</span>fromJSON)

<span class="co"># look at metadata structure</span>
<span class="kw">str</span>(metadata[[<span class="dv">1</span>]])
<span class="co">#&gt; 'data.frame':    1 obs. of  111 variables:</span>
<span class="co">#&gt;  $ Aperture Value             : chr "f/2.2"</span>
<span class="co">#&gt;  $ Brightness Value           : chr "5825/1686"</span>
<span class="co">#&gt;  $ Color Space                : chr "sRGB"</span>
<span class="co">#&gt;  $ Component 1                : chr "Y component: Quantization table 0, Sampling factors 2 horiz/2 vert"</span>
<span class="co">#&gt;  $ Component 2                : chr "Cb component: Quantization table 1, Sampling factors 1 horiz/1 vert"</span>
<span class="co">#&gt;  $ Component 3                : chr "Cr component: Quantization table 1, Sampling factors 1 horiz/1 vert"</span>
<span class="co">#&gt;  $ Components Configuration   : chr "YCbCr"</span>
<span class="co">#&gt;  $ Compression                : chr "JPEG (old-style)"</span>
<span class="co">#&gt;  $ Compression Type           : chr "Baseline"</span>
<span class="co">#&gt;  $ Content-Length             : chr "712286"</span>
<span class="co">#&gt;  $ Content-Type               : chr "image/jpeg"</span>
<span class="co">#&gt;  $ Creation-Date              : chr "2014-07-01T02:49:22"</span>
<span class="co">#&gt;  $ Data Precision             : chr "8 bits"</span>
<span class="co">#&gt;  $ Date/Time                  : chr "2014:07:01 09:49:22"</span>
<span class="co">#&gt;  $ Date/Time Digitized        : chr "2014:07:01 09:49:22"</span>
<span class="co">#&gt;  $ Date/Time Original         : chr "2014:07:01 09:49:22"</span>
<span class="co">#&gt;  $ Exif Image Height          : chr "3264 pixels"</span>
<span class="co">#&gt;  $ Exif Image Width           : chr "2448 pixels"</span>
<span class="co">#&gt;  $ Exif Version               : chr "2.21"</span>
<span class="co">#&gt;  $ Exposure Mode              : chr "Auto exposure"</span>
<span class="co">#&gt;  $ Exposure Program           : chr "Program normal"</span>
<span class="co">#&gt;  $ Exposure Time              : chr "1/30 sec"</span>
<span class="co">#&gt;  $ F-Number                   : chr "f/2.2"</span>
<span class="co">#&gt;  $ File Modified Date         : chr "Mon Feb 26 17:40:50 -08:00 2018"</span>
<span class="co">#&gt;  $ File Name                  : chr "calculator.jpg"</span>
<span class="co">#&gt;  $ File Size                  : chr "712286 bytes"</span>
<span class="co">#&gt;  $ Flash                      : chr "Flash did not fire"</span>
<span class="co">#&gt;  $ FlashPix Version           : chr "1.00"</span>
<span class="co">#&gt;  $ Focal Length               : chr "4.1 mm"</span>
<span class="co">#&gt;  $ Focal Length 35            : chr "30 mm"</span>
<span class="co">#&gt;  $ GPS Altitude               : chr "95 metres"</span>
<span class="co">#&gt;  $ GPS Altitude Ref           : chr "Sea level"</span>
<span class="co">#&gt;  $ GPS Latitude               : chr "34° 4' 19.22\""</span>
<span class="co">#&gt;  $ GPS Latitude Ref           : chr "N"</span>
<span class="co">#&gt;  $ GPS Longitude              : chr "-118° 26' 58.48\""</span>
<span class="co">#&gt;  $ GPS Longitude Ref          : chr "W"</span>
<span class="co">#&gt;  $ GPS Time-Stamp             : chr "16:49:21.860 UTC"</span>
<span class="co">#&gt;  $ GPS Version ID             : chr "2.200"</span>
<span class="co">#&gt;  $ ISO Speed Ratings          : chr "50"</span>
<span class="co">#&gt;  $ Image Height               : chr "3264 pixels"</span>
<span class="co">#&gt;  $ Image Width                : chr "2448 pixels"</span>
<span class="co">#&gt;  $ Last-Modified              : chr "2014-07-01T02:49:22"</span>
<span class="co">#&gt;  $ Last-Save-Date             : chr "2014-07-01T02:49:22"</span>
<span class="co">#&gt;  $ Lens Make                  : chr "Apple"</span>
<span class="co">#&gt;  $ Lens Model                 : chr "iPhone 5s back camera 4.12mm f/2.2"</span>
<span class="co">#&gt;  $ Lens Specification         : chr "4.12mm f/2.2"</span>
<span class="co">#&gt;  $ Make                       : chr "Apple"</span>
<span class="co">#&gt;  $ Metering Mode              : chr "Spot"</span>
<span class="co">#&gt;  $ Model                      : chr "iPhone 5s"</span>
<span class="co">#&gt;  $ Number of Components       : chr "3"</span>
<span class="co">#&gt;  $ Number of Tables           : chr "4 Huffman tables"</span>
<span class="co">#&gt;  $ Orientation                : chr "Top, left side (Horizontal / normal)"</span>
<span class="co">#&gt;  $ Resolution Unit            : chr "Inch"</span>
<span class="co">#&gt;  $ Resolution Units           : chr "none"</span>
<span class="co">#&gt;  $ Run Time                   : chr "[104 values]"</span>
<span class="co">#&gt;  $ Scene Capture Type         : chr "Standard"</span>
<span class="co">#&gt;  $ Scene Type                 : chr "Directly photographed image"</span>
<span class="co">#&gt;  $ Sensing Method             : chr "One-chip color area sensor"</span>
<span class="co">#&gt;  $ Shutter Speed Value        : chr "1/30 sec"</span>
<span class="co">#&gt;  $ Software                   : chr "7.1.1"</span>
<span class="co">#&gt;  $ Sub-Sec Time Digitized     : chr "854"</span>
<span class="co">#&gt;  $ Sub-Sec Time Original      : chr "854"</span>
<span class="co">#&gt;  $ Subject Location           : chr "1956 873 610 612"</span>
<span class="co">#&gt;  $ Thumbnail Height Pixels    : chr "0"</span>
<span class="co">#&gt;  $ Thumbnail Length           : chr "5163 bytes"</span>
<span class="co">#&gt;  $ Thumbnail Offset           : chr "1850 bytes"</span>
<span class="co">#&gt;  $ Thumbnail Width Pixels     : chr "0"</span>
<span class="co">#&gt;  $ Unique Image ID            : chr "bdeb111183eae36c0000000000000000"</span>
<span class="co">#&gt;  $ Unknown tag (0x0001)       : chr "0"</span>
<span class="co">#&gt;  $ Unknown tag (0x0002)       : chr "[558 values]"</span>
<span class="co">#&gt;  $ Unknown tag (0x0004)       : chr "1"</span>
<span class="co">#&gt;  $ Unknown tag (0x0005)       : chr "159"</span>
<span class="co">#&gt;  $ Unknown tag (0x0006)       : chr "163"</span>
<span class="co">#&gt;  $ Unknown tag (0x0007)       : chr "1"</span>
<span class="co">#&gt;  $ Unknown tag (0x0009)       : chr "19"</span>
<span class="co">#&gt;  $ White Balance Mode         : chr "Auto white balance"</span>
<span class="co">#&gt;  $ X Resolution               : chr "72 dots per inch"</span>
<span class="co">#&gt;  $ X-Parsed-By                :List of 1</span>
<span class="co">#&gt;   ..$ : chr  "org.apache.tika.parser.DefaultParser" "org.apache.tika.parser.jpeg.JpegParser"</span>
<span class="co">#&gt;  $ X-TIKA:content             : chr "&lt;html xmlns=\"http://www.w3.org/1999/xhtml\"&gt;\n&lt;head&gt;\n&lt;meta name=\"Exif Version\" content=\"2.21\" /&gt;\n&lt;meta n"| __truncated__</span>
<span class="co">#&gt;  $ X-TIKA:digest:MD5          : chr "829904e2f23a2095b7c46d13e92cab12"</span>
<span class="co">#&gt;  $ X-TIKA:parse_time_millis   : chr "184"</span>
<span class="co">#&gt;  $ XMP Value Count            : chr "0"</span>
<span class="co">#&gt;  $ Y Resolution               : chr "72 dots per inch"</span>
<span class="co">#&gt;  $ YCbCr Positioning          : chr "Center of pixel array"</span>
<span class="co">#&gt;  $ date                       : chr "2014-07-01T02:49:22"</span>
<span class="co">#&gt;  $ dcterms:created            : chr "2014-07-01T02:49:22"</span>
<span class="co">#&gt;  $ dcterms:modified           : chr "2014-07-01T02:49:22"</span>
<span class="co">#&gt;  $ exif:DateTimeOriginal      : chr "2014-07-01T02:49:22"</span>
<span class="co">#&gt;  $ exif:ExposureTime          : chr "0.03333333333333333"</span>
<span class="co">#&gt;  $ exif:FNumber               : chr "2.2"</span>
<span class="co">#&gt;  $ exif:Flash                 : chr "false"</span>
<span class="co">#&gt;  $ exif:FocalLength           : chr "4.12"</span>
<span class="co">#&gt;  $ exif:IsoSpeedRatings       : chr "50"</span>
<span class="co">#&gt;  $ geo:lat                    : chr "34.072006"</span>
<span class="co">#&gt;  $ geo:long                   : chr "-118.449578"</span>
<span class="co">#&gt;  $ meta:creation-date         : chr "2014-07-01T02:49:22"</span>
<span class="co">#&gt;  $ meta:save-date             : chr "2014-07-01T02:49:22"</span>
<span class="co">#&gt;  $ modified                   : chr "2014-07-01T02:49:22"</span>
<span class="co">#&gt;  $ resourceName               : chr "calculator.jpg"</span>
<span class="co">#&gt;   [list output truncated]</span>


<span class="co"># get content type from each data.frame</span>
    metadata <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">lapply</span>(<span class="cf">function</span>(x){ x<span class="op">$</span><span class="st">'Content-Type'</span> }) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">unlist</span>()
<span class="co">#&gt; [1] "image/jpeg"</span></code></pre></div>
<p>The most common metadata fields include <code>Content-Type</code>, <code>Content-Length</code>, <code>Creation-Date</code>, and <code>Content-Encoding</code>.</p>
<p>In addition, each specific format can have its own specialized metadata fields. For example, photos sometimes store latitude and longitude:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># get longitude and latitude </span>
    metadata <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">lapply</span>(<span class="cf">function</span>(x){ <span class="kw">as.numeric</span>(x<span class="op">$</span><span class="st">'geo:lat'</span>) }) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">unlist</span>()
<span class="co">#&gt; [1] 34.07201</span>

<span class="co"># get longitude and latitude</span>
    metadata <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">lapply</span>(<span class="cf">function</span>(x){ <span class="kw">as.numeric</span>(x<span class="op">$</span><span class="st">'geo:long'</span>) }) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">unlist</span>()
<span class="co">#&gt; [1] -118.4496</span></code></pre></div>
</div>
<div id="use-tika_json-for-container-documents" class="section level1">
<h1 class="hasAnchor">
<a href="#use-tika_json-for-container-documents" class="anchor"></a>Use tika_json() for “Container” Documents</h1>
<p>Some types of documents can have multiple objects within them. For example, a <code>.gzip</code> file can contain many other files. In the following example, I created a compressed archive of the Apache Tika homepage, using the command line program <code>wget</code> and <code>zip</code>. That downloaded the HTML, images, and other associated files into a compressed archive.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># wget gets a webpage and other files. </span>
<span class="co"># sys::exec_wait('wget', c('--page-requisites', 'https://tika.apache.org/'))</span>
<span class="co"># Put it all into a .zip file </span>
<span class="co"># sys::exec_wait('zip', c('-r', 'tika.apache.org.zip' ,'tika.apache.org'))</span>

batch =<span class="st"> </span><span class="kw">normalizePath</span>(<span class="st">'~/rtika/tests/testthat/tika.apache.org.zip'</span>)

<span class="co"># a list of data.frames</span>
metadata &lt;-
<span class="st">    </span>batch <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw"><a href="../reference/tika_json.html">tika_json</a></span>() <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">lapply</span>(jsonlite<span class="op">::</span>fromJSON)

<span class="co"># The structure is very long. See it with: str(metadata)</span></code></pre></div>
<p>Here are some of the important metadata fields:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
embedded_resource_path &lt;-<span class="st"> </span>
<span class="st">    </span>metadata <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">lapply</span>(<span class="cf">function</span>(x){ x<span class="op">$</span><span class="st">'X-TIKA:embedded_resource_path'</span> }) 

embedded_resource_path
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt;  [1] NA                       "/index.html"           </span>
<span class="co">#&gt;  [3] "/site.css"              "/external.png"         </span>
<span class="co">#&gt;  [5] "/icon_info_sml.gif"     "/icon_warning_sml.gif" </span>
<span class="co">#&gt;  [7] "/icon_error_sml.gif"    "/icon_success_sml.gif" </span>
<span class="co">#&gt;  [9] "/tika.png"              "/mattmann_cover150.jpg"</span>
<span class="co">#&gt; [11] "/asf-logo.gif"</span></code></pre></div>
<p>The <code>embedded_resource_path</code> tells you where in the document hierarchy an object resides. The first item in the character vector is the root, which is the actual container. As expected, it has a type of <code>application/zip</code>. The parser then recurses into the container and analyzes each object along the way, such as <code>application/xhtml+xml</code>, <code>image/png</code> and <code>text/css</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">content_type &lt;-
<span class="st">    </span>metadata <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">lapply</span>(<span class="cf">function</span>(x){ x<span class="op">$</span><span class="st">'Content-Type'</span> }) 

content_type
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt;  [1] "application/zip"                     </span>
<span class="co">#&gt;  [2] "application/xhtml+xml; charset=UTF-8"</span>
<span class="co">#&gt;  [3] "text/css; charset=ISO-8859-1"        </span>
<span class="co">#&gt;  [4] "image/png"                           </span>
<span class="co">#&gt;  [5] "image/gif"                           </span>
<span class="co">#&gt;  [6] "image/gif"                           </span>
<span class="co">#&gt;  [7] "image/gif"                           </span>
<span class="co">#&gt;  [8] "image/gif"                           </span>
<span class="co">#&gt;  [9] "image/png"                           </span>
<span class="co">#&gt; [10] "image/jpeg"                          </span>
<span class="co">#&gt; [11] "image/gif"</span>

content &lt;-<span class="st"> </span>
<span class="st">     </span>metadata <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">lapply</span>(<span class="cf">function</span>(x){ x<span class="op">$</span><span class="st">'X-TIKA:content'</span> })

<span class="kw">str</span>(content)
<span class="co">#&gt; List of 1</span>
<span class="co">#&gt;  $ : chr [1:11] "&lt;html xmlns=\"http://www.w3.org/1999/xhtml\"&gt;\n&lt;head&gt;\n&lt;meta name=\"X-Parsed-By\" content=\"org.apache.tika.par"| __truncated__ "&lt;html xmlns=\"http://www.w3.org/1999/xhtml\"&gt;\n&lt;head&gt;\n&lt;link rel=\"icon\" type=\"image/png\" href=\"./tikaNoTex"| __truncated__ "&lt;html xmlns=\"http://www.w3.org/1999/xhtml\"&gt;\n&lt;head&gt;\n&lt;meta name=\"date\" content=\"2014-12-20T07:36:10Z\" /&gt;\"| __truncated__ "&lt;html xmlns=\"http://www.w3.org/1999/xhtml\"&gt;\n&lt;head&gt;\n&lt;meta name=\"date\" content=\"2010-08-05T13:48:24Z\" /&gt;\"| __truncated__ ...</span></code></pre></div>
<p>It may be surprising to learn that Word documents are containers (the modern <code>.docx</code>). By parsing them with <code><a href="../reference/tika_json.html">tika_json()</a></code>, the images, XHTML tables, and other embedded objects can be analyzed.</p>
</div>
<div id="extending-rtika" class="section level1">
<h1 class="hasAnchor">
<a href="#extending-rtika" class="anchor"></a>Extending rtika</h1>
<p>Out of the box, <code>rtika</code> uses all the available Tika Detectors and Parsers and runs with sensible defaults. For most, this will work well.</p>
<p>In future versions, Tika will use standardized configuration files to customize parsing. The config file option is on hold for now, because Tika’s batch module is still new and the config file format will likely change and be backward incompatible with Tika 1.7. Please stay tuned.</p>
<p>Current Tika issues and progress can be seen here:<br><a href="https://issues.apache.org/jira/projects/TIKA/issues/TIKA-2368?filter=allopenissues" class="uri">https://issues.apache.org/jira/projects/TIKA/issues/TIKA-2368?filter=allopenissues</a></p>
<p>The Tika Wiki is here: <a href="https://wiki.apache.org/tika/FrontPage" class="uri">https://wiki.apache.org/tika/FrontPage</a></p>
<p>Tika sourcecode: <a href="https://github.com/apache/tika" class="uri">https://github.com/apache/tika</a></p>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references">
<div id="ref-mattmann2013computing">
<p>Mattmann, Chris A. 2013. “Computing: A Vision for Data Science.” <em>Nature</em> 493 (7433). Nature Publishing Group: 473.</p>
</div>
<div id="ref-mattmann2011tika">
<p>Mattmann, Chris, and Jukka Zitting. 2011. <em>Tika in Action</em>. Manning Publications Co. <a href="https://www.manning.com/books/tika-in-action" class="uri">https://www.manning.com/books/tika-in-action</a>.</p>
</div>
<div id="ref-silge2017text">
<p>Silge, Julia, and David Robinson. 2017. <em>Text Mining with R: A Tidy Approach</em>. “ O’Reilly Media, Inc.”</p>
</div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#a-digital-babel-fish">A Digital Babel Fish</a></li>
      <li><a href="#use-tika_text-to-extract-plain-text">Use tika_text() to Extract Plain Text</a></li>
      <li><a href="#parameters-for-very-big-datasets">Parameters for Very Big Datasets</a></li>
      <li><a href="#use-tika_fetch-to-preserve-content-type-when-downloading">Use tika_fetch() to Preserve Content-Type when Downloading</a></li>
      <li><a href="#use-either-tika_html-or-tika_xml-to-get-structured-xhtml">Use Either tika_html() or tika_xml() to Get Structured XHTML</a></li>
      <li><a href="#a-bit-of-xhtml-metadata">A Bit of XHTML Metadata</a></li>
      <li><a href="#use-tika_json-for-images">Use tika_json() for Images</a></li>
      <li><a href="#use-tika_json-for-container-documents">Use tika_json() for “Container” Documents</a></li>
      <li><a href="#extending-rtika">Extending rtika</a></li>
      <li><a href="#references">References</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Sasha Goodman, The Apache Software Foundation.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
